(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(e){e.target.classList.toggle("card__like-button_is-active")}function o(t,o,n,c){var r=t.name,u=t.link,a=e.querySelector(".places__item").cloneNode(!0),i=a.querySelector(".card__image");return i.src=u,i.alt=r,a.querySelector(".card__title").textContent=r,a.querySelector(".card__delete-button").addEventListener("click",(function(){return o(a)})),a.querySelector(".card__like-button").addEventListener("click",c),i.addEventListener("click",(function(){return n(r,u)})),a}function n(e){e.remove()}function c(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&r(t)}}function a(e){e.target.classList.contains("popup")&&r(e.target)}function i(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function s(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))}function l(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(o){return i(e,o,t)})),n.disabled=!0,n.classList.add(t.inactiveButtonClass)}var p={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-33",headers:{authorization:"1ad8ca18-9189-43b5-8819-a2f6900b4a3a","Content-Type":"application/json"}};function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var _={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){return e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);s(o,n,t),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,o):function(e,t,o,n){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),c.textContent=o,c.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,c,t),s(o,n,t)}))}))}(t,e)}))}(_);var f=document.querySelector(".popup_type_edit .popup__form"),m=document.querySelector(".popup_type_new-card .popup__form"),y=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),h=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),b=document.querySelectorAll(".popup__close"),C=S.querySelector(".popup__image"),L=S.querySelector(".popup__caption"),E=document.querySelector(".places__list"),g=document.querySelector(".popup__input_type_name"),k=document.querySelector(".popup__input_type_description"),x=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),B=document.querySelector(".popup__input_type_card-name"),w=document.querySelector(".popup__input_type_url");function U(e,t){C.src=t,C.alt=e,L.textContent=e,c(S)}f.addEventListener("submit",(function(e){var t,o;e.preventDefault(),(t=g.value,o=k.value,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:t,about:o})}).then(d).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){x.textContent=e.name,A.textContent=e.about,r(y)})).catch((function(e){console.log("Ошибка при обновлении профиля: ".concat(e))}))})),m.addEventListener("submit",(function(e){var c,u;e.preventDefault(),(c=B.value,u=w.value,fetch("".concat(p.baseUrl,"/cards"),{method:"POST",headers:p.headers,body:JSON.stringify({name:c,link:u})}).then(d).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){var c=o(e,n,U,t);E.prepend(c),m.reset(),r(v)})).catch((function(e){console.log("Ошибка при добавлении карточки: ".concat(e))}))})),h.addEventListener("click",(function(){g.value=x.textContent,k.value=A.textContent,l(f,_),c(y)})),q.addEventListener("click",(function(){m.reset(),l(m,_),c(v)})),b.forEach((function(e){e.addEventListener("click",(function(){var t=e.closest(".popup");t&&r(t)}))})),document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated"),e.addEventListener("mousedown",a)})),fetch("".concat(p.baseUrl,"/users/me"),{method:"GET",headers:p.headers}).then(d).catch((function(e){console.log("Ошибка: ".concat(e))})).then((function(e){x.textContent=e.name,A.textContent=e.about})).catch((function(e){console.log("Не удалось загрузить данные пользователя: ".concat(e))})),fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then(d).catch((function(e){console.log("Ошибка в getInitialCards: ".concat(e))})).then((function(e){!function(e){e.forEach((function(e){var c=o(e,n,U,t);E.append(c)}))}(e)})).catch((function(e){console.log("Не удалось загрузить данные карточки: ".concat(e))}))})();